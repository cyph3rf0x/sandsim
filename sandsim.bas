10   REM INTRO SETUP
11   GR : HOME
12   PRINT
13   HTAB 9: PRINT "RAINBOW SAND SIMULATOR"
14   HTAB 5: PRINT "(C) 1978 LABYRINTH SYSTEMS, INC."
20   DIM G(39,39)

30   REM CLEAR GRID
40   FOR Y=0 TO 39
50   FOR X=0 TO 39
60   G(X,Y)=0
70   NEXT X
80   NEXT Y

90   REM RANDOM PATTERN
100  FOR X=0 TO 39
110  FOR Y=0 TO 39
120  IF INT(RND(1) * 10)<3 THEN G(X,Y)=INT(RND(1)*16)
130  NEXT Y
140  NEXT X

160  REM DRAW INITIAL STATE
170  FOR Y=0 TO 39
180  FOR X=0 TO 39
190  COLOR=G(X,Y)
200  PLOT X,Y
210  NEXT X
220  NEXT Y

230  REM MAIN LOOP
240  FOR Y=38 TO 0 STEP -1
250  FOR X=0 TO 39
260  C=G(X,Y)
270  IF C=0 THEN 390
280  REM TRY DOWN
290  IF G(X,Y+1)=0 THEN DX=X : DY=Y+1 : GOTO 360
300  REM TRY DOWN-RIGHT
310  IF X<39 THEN IF G(X+1,Y+1)=0 THEN DX=X+1 : DY=Y+1 : GOTO 360
320  REM TRY DOWN-LEFT
330  IF X>0 THEN IF G(X-1,Y+1)=0 THEN DX=X-1 : DY=Y+1 : GOTO 360
340  REM STAY
350  GOTO 390
360  REM MOVE TO (DX,DY), KEEP SAME COLOR
370  G(X,Y)=0
380  G(DX,DY)=C
385  COLOR=0 : PLOT X,Y
386  COLOR=C : PLOT DX,DY
390  NEXT X
400  NEXT Y
410  GOTO 240
